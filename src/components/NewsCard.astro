---
interface Props {
  title: string;
  url: string;
  source: string;
  date: string;
  summary: string;
  slug: string;
  category: string;
  translations?: Record<string, { title: string; summary: string }>;
}

const { title, url, source, date, summary, translations } = Astro.props;

function relativeTime(dateStr: string): string {
  const now = new Date();
  const then = new Date(dateStr);
  const diffMs = now.getTime() - then.getTime();
  const diffMins = Math.floor(diffMs / 60000);
  if (diffMins < 60) return `${diffMins}m ago`;
  const diffHours = Math.floor(diffMins / 60);
  if (diffHours < 24) return `${diffHours}h ago`;
  const diffDays = Math.floor(diffHours / 24);
  return `${diffDays}d ago`;
}

const titleAttrs: Record<string, string> = { 'data-en': title };
const summaryAttrs: Record<string, string> = { 'data-en': summary };
if (translations) {
  for (const [lang, t] of Object.entries(translations)) {
    titleAttrs[`data-${lang}`] = t.title;
    summaryAttrs[`data-${lang}`] = t.summary;
  }
}
---
<article class="news-card">
  <h2 class="card-heading"><a href={url} target="_blank" rel="noopener noreferrer" class="card-title" {...titleAttrs}>{title} <span class="arrow">→</span></a></h2>
  <div class="card-meta">
    <span class="source">{source}</span>
    <span class="separator">·</span>
    <time datetime={date}>{relativeTime(date)}</time>
  </div>
  <p class="card-summary" {...summaryAttrs}>{summary}</p>
</article>

<style is:global>
  .news-card {
    padding: 1.25rem 0;
    border-bottom: 1px solid var(--border);
  }

  .card-heading {
    font-size: inherit;
    font-weight: inherit;
    margin: 0;
  }

  .card-title {
    font-size: 1.0625rem;
    font-weight: 600;
    color: var(--text);
    line-height: 1.4;
    display: block;
  }

  .card-title:hover {
    color: var(--accent);
    text-decoration: none;
  }

  .arrow {
    font-size: 0.875rem;
    opacity: 0;
    transition: opacity 0.15s;
  }

  .card-title:hover .arrow {
    opacity: 1;
  }

  .card-meta {
    font-size: 0.8125rem;
    color: var(--text-secondary);
    margin-top: 0.25rem;
  }

  .separator {
    margin: 0 0.375rem;
  }

  .card-summary {
    font-size: 0.9rem;
    color: var(--text-secondary);
    margin-top: 0.5rem;
    line-height: 1.5;
  }
</style>
