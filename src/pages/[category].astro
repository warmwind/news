---
import BaseLayout from '../layouts/BaseLayout.astro';
import CategoryNav from '../components/CategoryNav.astro';
import NewsCard from '../components/NewsCard.astro';

const categoryLabels: Record<string, string> = {
  tech: 'Tech',
  ai: 'AI',
  economic: 'Economic',
  github: 'GitHub',
  sports: 'Sports',
};

export function getStaticPaths() {
  return ['tech', 'ai', 'economic', 'github', 'sports'].map(category => ({
    params: { category },
  }));
}

const { category } = Astro.params;
const label = categoryLabels[category!] || category;

const newsFiles = import.meta.glob('../data/news/*/*.json', { eager: true });
const articles: Array<{ title: string; slug: string; url: string; source: string; date: string; summary: string; content: string; category: string; translations?: Record<string, { title: string; summary: string }> }> = [];

for (const [path, mod] of Object.entries(newsFiles)) {
  // path looks like ../data/news/{category}/{date}.json
  const pathCategory = path.split('/').at(-2);
  if (pathCategory !== category) continue;
  const data = (mod as any).default || mod;
  if (Array.isArray(data)) {
    articles.push(...data);
  }
}

articles.sort((a, b) => new Date(b.date).getTime() - new Date(a.date).getTime());
---
<BaseLayout title={`${label} - Oscar's News`}>
  <CategoryNav active={category} />
  {articles.map(article => (
    <NewsCard
      title={article.title}
      url={article.url}
      source={article.source}
      date={article.date}
      summary={article.summary}
      slug={article.slug}
      category={article.category}
      translations={article.translations}
    />
  ))}
</BaseLayout>
