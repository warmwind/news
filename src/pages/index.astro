---
import BaseLayout from '../layouts/BaseLayout.astro';
import CategoryNav from '../components/CategoryNav.astro';
import NewsCard from '../components/NewsCard.astro';

const newsFiles = import.meta.glob('../data/news/*/*.json', { eager: true });
const allNews: Array<{ title: string; slug: string; url: string; source: string; date: string; summary: string; content: string; category: string; translations?: Record<string, { title: string; summary: string }> }> = [];

for (const [, mod] of Object.entries(newsFiles)) {
  const articles = (mod as any).default || mod;
  if (Array.isArray(articles)) {
    allNews.push(...articles);
  }
}

allNews.sort((a, b) => new Date(b.date).getTime() - new Date(a.date).getTime());
const latest = allNews.slice(0, 20);
---
<BaseLayout>
  <CategoryNav active="all" />
  {latest.map(article => (
    <NewsCard
      title={article.title}
      url={article.url}
      source={article.source}
      date={article.date}
      summary={article.summary}
      slug={article.slug}
      category={article.category}
      translations={article.translations}
    />
  ))}
</BaseLayout>
